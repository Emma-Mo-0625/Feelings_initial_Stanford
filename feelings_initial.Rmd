---
title: "Feelings_initial"
output:
  pdf_document: default
  html_document: default
date: "2025-04-13"
---

```{r}
feelings_initial <- load("feelings_initial.RData")
ls()
```

```{r}
summary(feelings_initial)
```

```{r}
str(dat)
```


## Descriptive statistics

```{r}
summary(dat[, c("Ineg", "Ipos", "Iaro")])
```

```{r}
# identify NAs
colSums(is.na(dat))
```

There are no NAs in the dataset.

```{r}
# identify outliers using z-score

# Calculate Z-scores for Ineg, Ipos, and Iaro
dat$z_Ineg <- scale(dat$Ineg)
dat$z_Ipos <- scale(dat$Ipos)
dat$z_Iaro <- scale(dat$Iaro)

# Identify outliers (Z-score > 3 or < -3)
outliers_Ineg <- dat[abs(dat$z_Ineg) > 3, ]
outliers_Ineg
outliers_Ipos <- dat[abs(dat$z_Ipos) > 3, ]
outliers_Ipos
outliers_Iaro <- dat[abs(dat$z_Iaro) > 3, ]
outliers_Iaro

```

There are no outliers.

## Mixed-effects model: analyze data with repeated measures

- Each participant has multiple trials, so the trials within a participant are likely correlated
- Data is nested
- Each participant may have their own baseline level of emotional responses

- fixed effects (trial.val, sex, age, ethn) explain the variation between individuals
- random effects (1|subj) explain the correlation of repeated measures within individuals

```{r}
library(lme4)

# Mixed-effects model for predicting Ineg
model_ineg <- lmer(Ineg ~ trial.val + sex + age + ethn + (1|subj), data = dat)
summary(model_ineg)

```

- Random effects: each participant has a different baseline emotional response
  - `(1|subj)`: represents the random effect 
    - each participant (subj) has a different baseline deviation (intercept). 
    - This accounts for the correlation between multiple trial results from the same participant
- `REML score` (residual maximum likelihood estimate): assess the model fit
- Fixed Effects:
  - Intercept: Negative trial
  - `trial.valneu` (Neutral trial): Estimate = -4.08, t = -118.57, a very significant negative value. 
    - Compared to the baseline (negative trial), the neutral trial significantly decreases negative emotions (Ineg)
  - `trial.valpos` (Positive trial): Estimate = -4.09, t = -168.08, also significant. 
    - the positive trial also significantly decreases negative emotions compared to the negative trial
  - sexfemale: Estimate = 0.317543, t = 2.606. 
    - Females have significantly higher negative emotional responses (Ineg) compared to males
  - The effects of age and ethnicity are small and not significant


```{r}
# Mixed-effects model for predicting Ipos
model_ipos <- lmer(Ipos ~ trial.val + sex + age + ethn + (1|subj), data = dat)
summary(model_ipos)
```

- Intercept (negative trial): estimate = 0.72, t-value = 1.56. The effect of negative trial on positive emotions (Ipos) is small.
- `trial.valneu`: estimate = 0.34, t-value = 9.48. Compared to valneg, the neutral trial significantly increases positive emotions (Ipos).
- `trial.valpos`: estimate = 4.03, t-value = 160.64. Compared to valneg, the positive trial largely increases positive emotions (Ipos), and the effect is extremely significant.
- `sexfemale`: estimate = 0.20, t = 1.58. Females tend to have slightly higher positive emotional responses than males.
- `ethnAmerican Indian/Native American or Alaskan Native`: estimate = -0.94, t = -2.30. This ethnicity tends to have significantly lower positive emotional responses compared to the reference group.
- `trial.valneu` and `trial.valpos` have a correlation of 0.354, showing that the effects of neutral and positive trials are somewhat related.


```{r}
# Mixed-effects model for predicting Iaro
model_aro <- lmer(Iaro ~ trial.val + sex + age + ethn + (1|subj), data = dat)
summary(model_aro)
```

- Intercept (negative trial): estimate = 2.93, t-value = 3.84. The effect of negative trial on arousal (Iaro) is moderate.
- `trial.valneu`: estimate -2.26, t-value = -64.28. Compared to `valneg`, the neutral trial significantly decreases arousal (Iaro), which can be expected.
- `trial.valpos`: estimate = -0.30, t-value = -12.10. Compared to `valneg`, the positive trial also significantly decreases arousal (Iaro), but the effect is small.
- Other fixed effects are not significant.


## Autoregressive Modeling

Assign 1 overall inertia score for pos, neg, and aro for each participant:

```{r}
library(dplyr)
library(purrr)
library(broom)

# Create a function to return inertia (lag-1 beta value)
get_inertia <- function(x) {
  # Create lagged data
  lag_x <- dplyr::lag(x)
  df <- data.frame(current = x, lagged = lag_x)
  df <- na.omit(df)
  
  # Linear regression: current ~ lagged
  model <- lm(current ~ lagged, data = df)
  coef(model)["lagged"]
}

# find inertia scores for the 3 emotions for each participant
overall_inertia <- dat %>%
  group_by(subj) %>%
  summarise(
    pos_inertia = get_inertia(Ipos),
    neg_inertia = get_inertia(Ineg),
    aro_inertia = get_inertia(Iaro)
  )
overall_inertia
```

For each of the 3 emotional reactions (pos, neg, aro), assign 1 inertia score for each of the 3 trial type (pos, neg, neu)

```{r}
library(tidyr)

# For each subj × trial.val × emotion
inertia_long <- dat %>%
  group_by(subj, trial.val) %>%
  summarise(
    pos_inertia = get_inertia(Ipos),
    neg_inertia = get_inertia(Ineg),
    aro_inertia = get_inertia(Iaro),
    .groups = "drop"
  )

# Reshape into wide format: 1 row per participant, 9 inertia scores
inertia_wide <- inertia_long %>%
  pivot_wider(
    names_from = trial.val,
    values_from = c(pos_inertia, neg_inertia, aro_inertia),
    names_glue = "{.value}_{trial.val}"
  )

inertia_wide
```

```{r}
# Find the reason of NAs

# Whether there's not enough data for each subj × trial.val group?

dat %>%
  group_by(subj, trial.val) %>%
  summarise(n = n()) %>%
  filter(n < 5)

# Whether some emotion ratings for certain trial type are always the same?

dat %>%
  group_by(subj, trial.val) %>%
  summarise(
    Ineg_var = var(Ineg),
    Ipos_var = var(Ipos),
    Iaro_var = var(Iaro)
  ) %>%
  filter(Ineg_var == 0 | Ipos_var == 0 | Iaro_var == 0)

```

- The reason of NAs is not due to insufficient data for each subj × trial.val group
- NAs are also not likely to be caused by zero-variance of some emotion inertia ratings, since NAs from inertia_wide are more than the number of Var = 0.


```{r}
# Merge all inertia scores (by subj)
inertia_all <- overall_inertia %>%
  left_join(inertia_wide, by = "subj")
inertia_all
```


```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(e1071)   # for skewness
library(psych)   # for describe()

# Convert to inertia_long format
inertia_long <- inertia_all %>%
  pivot_longer(-subj, names_to = "inertia_type", values_to = "inertia")

# Distribution & Skewness
inertia_long %>%
  group_by(inertia_type) %>%
  mutate(
    skew = skewness(inertia, na.rm = TRUE),
    normality_p = shapiro.test(inertia)$p.value
  ) %>%
  ggplot(aes(x = inertia)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "white") +
  facet_wrap(~ inertia_type, scales = "free") +
  theme_minimal() +
  labs(title = "Histogram of Inertia Scores across Participants",
       subtitle = "Check for skewness & normality visually")

```

```{r}
# describe_stats for all 3 + 9 = 12 types of inertia
describe_stats <- inertia_long %>%
  group_by(inertia_type) %>%
  summarise(
    n = sum(!is.na(inertia)),
    sd = sd(inertia, na.rm = TRUE),
    Q1 = quantile(inertia, 0.25, na.rm = TRUE),
    Q3 = quantile(inertia, 0.75, na.rm = TRUE),
    skewness = skewness(inertia, na.rm = TRUE),
    normality_p = shapiro.test(inertia)$p.value
  )
describe_stats
```

Inertia scores that are not normal:

- neg_inertia_pos: normality_p = 6.689087e-10; skewness = 1.07982750
  - Under positive stimuli, negative emotion inertia is right-skewed: a few individuals have unusually persistent negative emotions
- pos_inertia_neg: normality_p = 2.318693e-09; skewness = 1.27067898
  - Under negative stimuli, positive emotion inertia is strongly right-skewed: most people have low inertia in positive feelings, with a few showing strong inertia
- pos_inertia_neu: normality_p = 8.436415e-08; skewness = -0.39896752
  - For neutral stimuli, positive emotion inertia is slightly left-skewed
- neg_inertia_neu: normality_p = 1.296106e-07; skewness = 1.29575508
  - For neutral stimuli, negative emotion inertia is strongly right-skewed
- aro_inertia_neu: normality_p = 3.859573e-05; skewness = 0.71497318
  - For neutral stimuli, arousal inertia is right-skewed


### Normalize the skewed inertia types

```{r}
# Transform the skewed inertia types to normal
library(bestNormalize)

skewed_vars <- c(
  "neg_inertia_pos", "pos_inertia_neg", "pos_inertia_neu",
  "neg_inertia_neu", "aro_inertia_neu"
)

inertia_long_normalized <- inertia_long %>%
  group_by(inertia_type) %>%
  mutate(
    inertia_trans = if_else(
      inertia_type %in% skewed_vars,
      orderNorm(inertia)$x.t,  # transform only these
      inertia  # leave others unchanged
    )
  )

inertia_long_normalized
```


### Compare means of the 12 inertia types

```{r}
# Find mean value of each of the 12 inertia types

inertia_means <- inertia_long_normalized %>%
  group_by(inertia_type) %>%
  summarise(
    mean_inertia = mean(inertia_trans, na.rm = TRUE),
    sd_inertia = sd(inertia_trans, na.rm = TRUE),
    n = sum(!is.na(inertia_trans))
  ) %>%
  arrange(desc(abs(mean_inertia)))

inertia_means
```

- aro_inertia_neu: Extremely high SD (0.998) — suggests arousal inertia under neutral stimuli varies greatly across individuals
- neg_inertia (mean = -0.024): Negative emotion inertia is slightly negative, meaning negative emotion is not likely to last
- neg_inertia_pos: Negative near-zero mean (-9.32e-06) but very high variance (sd = 0.999); 

  - Negative emotion is likely to bounce back after positive stimuli, but the effect is extremely small
  - There's huge individual differences
  
- pos_inertia_neg: Negative near-zero mean (-3.28e-05) but very high variance (sd = 0.999);

  - Positive emotion is likely to bounce back after negative stimuli, but the effect is also small
  - There's huge individual differences

- pos_inertia (mean = -0.032): negative mean — indicates that positive emotions tend to drop off quickly
- aro_inertia_neg (mean = 0.031): clear positive inertia — arousal tends to linger more after negative stimuli
- neg_inertia_neg (mean = 0.024): negative emotions tend to persist more after negative trials

- **neg_inertia (mean = -0.024) vs. pos_inertia (mean = -0.032)**:

  - **neg_inertia is bigger than pos_inertia, meaning that negative emotions tend to last longer**
  - Positive emotions bounce back faster than negative emotions

- **neg_inertia_pos (mean = -9.32e-06) vs. pos_inertia_neg (-3.28e-05)**:

  - **Emotions tend to reset quickly when the stimulus is the opposite, meaning that people are likely to be affected by opposite stimuli**
  - **Positive emotions may dissipate faster in response to negative stimuli than negative emotions do in response to positive ones (positive emotion is more likely to be affected by negative stimuli)**



### Compare inertia types by demographics

```{r}
# Pivot transformed inertia data to wide format

inertia_wide_trans <- inertia_long_normalized %>%
  select(subj, inertia_type, inertia_trans) %>%
  tidyr::pivot_wider(
    names_from = inertia_type,
    values_from = inertia_trans
  )

# Extract demographic info from your original dat

demo_info <- dat %>%
  select(subj, sex, age, ethn) %>%
  distinct()

# Merge the transformed inertia data with demographics
inertia_full <- inertia_wide_trans %>%
  left_join(demo_info, by = "subj")
inertia_full
```


```{r}
# Inertia types by Sex / Ethnicity (categorical)

# By sex
inertia_full %>%
  group_by(sex) %>%
  summarise(across(starts_with("pos_inertia"):starts_with("aro_inertia"), ~mean(., na.rm = TRUE)))

# Visualize
ggplot(inertia_full, aes(x = sex, y = pos_inertia)) +
  geom_boxplot() +
  labs(title = "Positive Emotion Inertia by Sex")


```

- Females have much lower positive inertia (-0.043) than males (-0.021) -> quicker drop in positive feelings
- Females have higher arousal inertia (0.019) than males (-0.011) -> more sustained arousal
- It's surprising that neg_inertia is about the same for male and female, considering that females are twice as likely as males to get depression based on reports


```{r}
# By ethnicity
inertia_full %>%
  group_by(ethn) %>%
  summarise(across(starts_with("pos_inertia"):starts_with("aro_inertia"), ~mean(., na.rm = TRUE)))
```

- American Indian/Native American or Alaskan Native: the only group with positive neg_inertia -> tend to stay in negative states longer
- Black/African American: the only group with pos_inertia -> tend to stay in positive states longer (which is unexpected)
- White/Caucasian: the only group with negative inertia across all three emotions -> tend to bounce back quickly overall (emotionally adaptive). 
  - This may reflect greater access to resources, social safety nets, and less exposure to systemic stressors for White people.
- Both "Other" and "Decline to state" have much higher aro_inertia than others. 
  - This may suggest that the people who are less confident or more confused about their identities are likely to face heightened stress, social vigilance, or lack of belonging--all known to elevate arousal.


```{r}
# Inertia types by Age (continuous)

inertia_full %>%
  summarise(across(
    starts_with("pos_inertia"):starts_with("aro_inertia"),
    ~ cor(., age, use = "complete.obs")
  ))
```

- As age increases, neg_inertia (-0.128) decreases more than pos_inertia (-0.011). 
  - Negative emotions drop significantly faster with increasing age -> older participants are more resilient to negative emotions
- Arousal shows a slight increase with age (0.029)




